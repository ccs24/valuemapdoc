{"version":3,"file":"tabs.min.js","sources":["../src/tabs.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Lightweight tabs handler for Moodle plugin.\n *\n * @copyright  2024\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/* eslint-env es6 */\n\ndefine([], function() {\n    return {\n        /**\n         * Initialize tab switching based on URL hash and clicks.\n         */\n        init: function() {\n            /**\n             * Shows the selected tab and activates the corresponding navigation link.\n             *\n             * @param {string} hash - The ID of the tab to activate (including #).\n             */\n            function showTab(hash) {\n                document.querySelectorAll('#valuemapdoc-tabs .tab-pane').forEach(function(tab) {\n                    tab.classList.remove('active', 'show');\n                });\n                document.querySelectorAll('#valuemapdoc-tabs .nav-link').forEach(function(link) {\n                    link.classList.remove('active');\n                });\n\n                var activeTab = document.querySelector(hash);\n                var activeLink = document.querySelector('[data-href=\"' + hash + '\"]');\n\n                if (activeTab) {\n                    activeTab.classList.add('active', 'show');\n                }\n                if (activeLink) {\n                    activeLink.classList.add('active');\n                }\n            }\n\n            document.querySelectorAll('#valuemapdoc-tabs .nav-link').forEach(function(link) {\n                link.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    var targetHash = this.getAttribute('data-href');\n                    if (targetHash) {\n                        if (targetHash === '#content-tab') {\n                            // Use require instead of dynamic import\n                            require(['mod_valuemapdoc/tablecontent'], function(module) {\n                                module.init();\n\n                                var spinner = document.querySelector('#spinner-indicator');\n                                var isPending = sessionStorage.getItem('valuemapdoc_pending_generation') === '1';\n                                var startTime = Date.now();\n\n                                if (spinner && isPending) {\n                                    spinner.classList.remove('d-none');\n                                }\n\n                                /**\n                                 * Polls the server every 5 seconds to check if any content document has status 'ready'.\n                                 * Hides spinner once a document is ready or after a timeout.\n                                 */\n                                function checkDocumentsReady() {\n                                    require(['core/ajax'], function(Ajax) {\n                                        var container = document.querySelector('#valuemapdoc-content-table');\n                                        if (!container) {\n                                            return;\n                                        }\n\n                                        var courseid = container.dataset.courseid;\n                                        var cmid = container.dataset.cmid;\n\n                                        Ajax.call([{\n                                            methodname: 'mod_valuemapdoc_get_content_entries',\n                                            args: {\n                                                courseid: courseid,\n                                                cmid: cmid,\n                                                include_master: 0\n                                            }\n                                        }])[0].then(function(entries) {\n                                            var ready = entries.length && entries.some(function(e) {\n                                                return e.status === 'ready';\n                                            });\n                                            var expired = (Date.now() - startTime > 20000); // 20s timeout\n\n                                            if (ready || expired) {\n                                                if (spinner) {\n                                                    spinner.classList.add('d-none');\n                                                }\n                                                sessionStorage.removeItem('valuemapdoc_pending_generation');\n                                            } else {\n                                                setTimeout(checkDocumentsReady, 5000);\n                                            }\n                                        });\n                                    });\n                                }\n\n                                if (isPending) {\n                                    checkDocumentsReady();\n                                }\n\n                                showTab(targetHash);\n                            });\n                        } else {\n                            history.pushState(null, null, targetHash);\n                            showTab(targetHash);\n                        }\n                    }\n                });\n            });\n\n            if (window.location.hash) {\n                showTab(window.location.hash);\n            } else {\n                var firstTabLink = document.querySelector('#valuemapdoc-tabs .nav-link[data-href]');\n                if (firstTabLink) {\n                    var firstHash = firstTabLink.getAttribute('data-href');\n                    if (firstHash) {\n                        history.replaceState(null, null, firstHash);\n                        showTab(firstHash);\n                    }\n                }\n            }\n\n            window.addEventListener('hashchange', function() {\n                if (window.location.hash) {\n                    showTab(window.location.hash);\n                }\n            });\n        }\n    };\n});"],"names":["define","init","showTab","hash","document","querySelectorAll","forEach","tab","classList","remove","link","activeTab","querySelector","activeLink","add","addEventListener","e","preventDefault","targetHash","this","getAttribute","require","module","spinner","isPending","sessionStorage","getItem","startTime","Date","now","checkDocumentsReady","Ajax","container","courseid","dataset","cmid","call","methodname","args","include_master","then","entries","ready","length","some","status","expired","removeItem","setTimeout","history","pushState","window","location","firstTabLink","firstHash","replaceState"],"mappings":";;;;;;AAuBAA,8BAAO,IAAI,iBACA,CAIHC,KAAM,oBAMOC,QAAQC,MACbC,SAASC,iBAAiB,+BAA+BC,SAAQ,SAASC,KACtEA,IAAIC,UAAUC,OAAO,SAAU,WAEnCL,SAASC,iBAAiB,+BAA+BC,SAAQ,SAASI,MACtEA,KAAKF,UAAUC,OAAO,iBAGtBE,UAAYP,SAASQ,cAAcT,MACnCU,WAAaT,SAASQ,cAAc,eAAiBT,KAAO,MAE5DQ,WACAA,UAAUH,UAAUM,IAAI,SAAU,QAElCD,YACAA,WAAWL,UAAUM,IAAI,aAIjCV,SAASC,iBAAiB,+BAA+BC,SAAQ,SAASI,MACtEA,KAAKK,iBAAiB,SAAS,SAASC,GACpCA,EAAEC,qBACEC,WAAaC,KAAKC,aAAa,aAC/BF,aACmB,iBAAfA,WAEAG,QAAQ,CAAC,iCAAiC,SAASC,QAC/CA,OAAOrB,WAEHsB,QAAUnB,SAASQ,cAAc,sBACjCY,UAAyE,MAA7DC,eAAeC,QAAQ,kCACnCC,UAAYC,KAAKC,MAEjBN,SAAWC,WACXD,QAAQf,UAAUC,OAAO,UA0CzBe,oBAnCKM,sBACLT,QAAQ,CAAC,cAAc,SAASU,UACxBC,UAAY5B,SAASQ,cAAc,iCAClCoB,eAIDC,SAAWD,UAAUE,QAAQD,SAC7BE,KAAOH,UAAUE,QAAQC,KAE7BJ,KAAKK,KAAK,CAAC,CACPC,WAAY,sCACZC,KAAM,CACFL,SAAUA,SACVE,KAAMA,KACNI,eAAgB,MAEpB,GAAGC,MAAK,SAASC,aACbC,MAAQD,QAAQE,QAAUF,QAAQG,MAAK,SAAS5B,SAC5B,UAAbA,EAAE6B,UAETC,QAAWlB,KAAKC,MAAQF,UAAY,IAEpCe,OAASI,SACLvB,SACAA,QAAQf,UAAUM,IAAI,UAE1BW,eAAesB,WAAW,mCAE1BC,WAAWlB,oBAAqB,YAO5CA,GAGJ5B,QAAQgB,gBAGZ+B,QAAQC,UAAU,KAAM,KAAMhC,YAC9BhB,QAAQgB,oBAMpBiC,OAAOC,SAASjD,KAChBD,QAAQiD,OAAOC,SAASjD,UACrB,KACCkD,aAAejD,SAASQ,cAAc,6CACtCyC,aAAc,KACVC,UAAYD,aAAajC,aAAa,aACtCkC,YACAL,QAAQM,aAAa,KAAM,KAAMD,WACjCpD,QAAQoD,aAKpBH,OAAOpC,iBAAiB,cAAc,WAC9BoC,OAAOC,SAASjD,MAChBD,QAAQiD,OAAOC,SAASjD"}