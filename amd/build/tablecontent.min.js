define("mod_valuemapdoc/tablecontent",["core/ajax","core/str","core/notification","jquery"],(function(Ajax,Str,Notification,$){return{init:function(params){console.log("üì¶ ZA≈ÅADOWANO plik tablecontent.js");var self=this;setTimeout((function(){console.log("üöÄ init funkcja zosta≈Ça uruchomiona");var el=document.querySelector("#valuemapdoc-content-table");if(el){var courseid=el.dataset.courseid,cmid=params&&params.cmid?params.cmid:el.dataset.cmid,templateid=params&&params.templateid?params.templateid:el.dataset.templateid;self.courseid=courseid,self.cmid=cmid,self.templateid=templateid,self.tableElement=el,self.initRefreshButton(),self.loadTableContent(courseid,cmid,templateid,el)}else console.error("‚ùå Nie znaleziono elementu DOM: #valuemapdoc-content-table")}),0)},loadTableContent:function(courseid,cmid,templateid,el,callback){var self=this;Ajax.call([{methodname:"mod_valuemapdoc_get_content_entries",args:{courseid:courseid,cmid:cmid,include_master:templateid}}])[0].then((function(response){console.log("üì• Otrzymane dane z AJAX:",response);response.map((function(entry){return Object.assign({},entry,{opportunityname:entry.name})}));var html="";0===response.length?html='<div class="alert alert-info text-center"><i class="fa fa-info-circle fa-2x mb-2" aria-hidden="true"></i><h5>Brak dokument√≥w</h5><p>Nie ma jeszcze utworzonych dokument√≥w. Wygeneruj pierwszy dokument, aby rozpoczƒÖƒá.</p></div>':(html='<div class="table-responsive"><table class="table table-striped table-hover"><thead class="thead-light"><tr><th scope="col">Nazwa dokumentu</th><th scope="col">Szablon</th><th scope="col">Utworzony</th><th scope="col">Status</th><th scope="col">Ocena</th><th scope="col" class="text-center">Akcje</th></tr></thead><tbody>',response.forEach((function(entry){console.log("üîç Przetwarzanie wpisu:",entry);var templateName=entry.templatename||"Brak szablonu",createdDate=entry.timecreated,statusBadge="";statusBadge="pending"===entry.status?'<span class="badge badge-warning"><i class="fa fa-clock-o"></i> Generowanie</span>':"error"===entry.status?'<span class="badge badge-danger"><i class="fa fa-exclamation-triangle"></i> B≈ÇƒÖd</span>':1==entry.visibility?'<span class="badge badge-warning"><i class="fa fa-lock"></i> Prywatny</span>':'<span class="badge badge-success"><i class="fa fa-globe"></i> Wsp√≥≈Çdzielony</span>';var ratingDisplay='<span class="text-muted">Nie oceniony</span>';null!==entry.effectiveness&&void 0!==entry.effectiveness&&(1==entry.effectiveness?ratingDisplay='<span class="text-success"><i class="fa fa-thumbs-up"></i> Dobry</span>':0==entry.effectiveness?ratingDisplay='<span class="text-warning"><i class="fa fa-meh-o"></i> Neutralny</span>':-1==entry.effectiveness&&(ratingDisplay='<span class="text-danger"><i class="fa fa-thumbs-down"></i> Z≈Çy</span>'));var actionButtons="";actionButtons="pending"===entry.status?'<div class="btn-group btn-group-sm" role="group"><button class="btn btn-outline-secondary btn-sm" disabled><i class="fa fa-clock-o"></i></button><a href="'+M.cfg.wwwroot+"/mod/valuemapdoc/rate_content.php?id="+cmid+"&docid="+entry.id+'" class="btn btn-outline-primary btn-sm" title="PodglƒÖd i ocena"><i class="fa fa-eye"></i></a><button class="btn btn-outline-danger btn-sm delete-document" data-docid="'+entry.id+'" data-docname="'+entry.name+'" title="Usu≈Ñ dokument"><i class="fa fa-trash"></i></button></div>':"error"===entry.status?'<div class="btn-group btn-group-sm" role="group"><button class="btn btn-outline-danger btn-sm" disabled><i class="fa fa-exclamation-triangle"></i></button><a href="'+M.cfg.wwwroot+"/mod/valuemapdoc/rate_content.php?id="+cmid+"&docid="+entry.id+'" class="btn btn-outline-primary btn-sm" title="PodglƒÖd i ocena"><i class="fa fa-eye"></i></a><button class="btn btn-outline-danger btn-sm delete-document" data-docid="'+entry.id+'" data-docname="'+entry.name+'" title="Usu≈Ñ dokument"><i class="fa fa-trash"></i></button></div>':'<div class="btn-group btn-group-sm" role="group"><a href="'+M.cfg.wwwroot+"/mod/valuemapdoc/rate_content.php?id="+cmid+"&docid="+entry.id+'" class="btn btn-outline-primary btn-sm" title="PodglƒÖd i ocena"><i class="fa fa-eye"></i></a><a href="'+M.cfg.wwwroot+"/mod/valuemapdoc/edit_content.php?id="+cmid+"&docid="+entry.id+'" class="btn btn-outline-secondary btn-sm" title="Edytuj"><i class="fa fa-edit"></i></a><a href="'+M.cfg.wwwroot+"/mod/valuemapdoc/tune_content.php?id="+cmid+"&docid="+entry.id+'" class="btn btn-outline-info btn-sm" title="Dostraj"><i class="fa fa-cog"></i></a><button class="btn btn-outline-danger btn-sm delete-document" data-docid="'+entry.id+'" data-docname="'+entry.name+'" title="Usu≈Ñ dokument"><i class="fa fa-trash"></i></button></div>';var modifiedDate="";entry.timemodified&&entry.timemodified!==entry.timecreated&&(modifiedDate='<br><small class="text-muted">Zmieniony: '+new Date(1e3*entry.timemodified).toLocaleDateString("pl-PL")+"</small>");var contentPreview="";entry.content&&(contentPreview='<br><small class="text-muted">'+entry.content+"</small>"),html+='<tr class="document-row" data-docid="'+entry.id+'"><td><div class="d-flex align-items-center"><i class="fa fa-file-text-o text-primary mr-2" aria-hidden="true"></i><div><strong>'+entry.name+"</strong>"+contentPreview+'</div></div></td><td><span class="badge badge-secondary">'+templateName+"</span></td><td><small>"+createdDate+"</small>"+modifiedDate+"</td><td>"+statusBadge+"</td><td>"+ratingDisplay+'</td><td class="text-center">'+actionButtons+"</td></tr>"})),html+="</tbody></table></div>");var initialDocs=document.querySelector(".initial-documents");initialDocs&&initialDocs.remove(),el.classList.remove("d-none"),el.innerHTML=html,self.addTableInteractions(courseid,cmid,templateid,el),"function"==typeof callback&&callback()})).catch((function(error){console.error("‚ùå AJAX error:",error),el.innerHTML='<div class="alert alert-danger"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>WystƒÖpi≈Ç b≈ÇƒÖd podczas ≈Çadowania dokument√≥w. <button class="btn btn-sm btn-outline-danger ml-2" onclick="location.reload()"><i class="fa fa-refresh"></i> Od≈õwie≈º</button></div>',"function"==typeof callback&&callback()}))},addTableInteractions:function(courseid,cmid,templateid,el){var self=this;document.querySelectorAll(".document-row").forEach((function(row){row.addEventListener("mouseenter",(function(){this.classList.add("table-active")})),row.addEventListener("mouseleave",(function(){this.classList.remove("table-active")})),row.addEventListener("dblclick",(function(){var viewLink=this.querySelector('a[title*="PodglƒÖd"]');viewLink&&window.open(viewLink.href,"_blank")}))})),document.querySelectorAll(".delete-document").forEach((function(button){button.addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation();var docId=button.dataset.docid,docName=button.dataset.docname;self.showDeleteConfirmation(docId,docName,courseid,cmid,templateid,el)}))})),console.log("‚úÖ Dodano interakcje do tabeli")},showDeleteConfirmation:function(docId,docName,courseid,cmid,templateid,el){var self=this,modalHtml='<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="deleteConfirmModalLabel"><i class="fa fa-exclamation-triangle text-warning"></i> Potwierdzenie usuniƒôcia</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><p>Czy na pewno chcesz usunƒÖƒá dokument:</p><p><strong>"'+docName+'"</strong></p><div class="alert alert-warning"><i class="fa fa-warning"></i><strong>Uwaga:</strong> Ta operacja jest nieodwracalna!</div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i> Anuluj</button><button type="button" class="btn btn-danger" id="confirmDeleteBtn"><i class="fa fa-trash"></i> Usu≈Ñ dokument</button></div></div></div></div>',existingModal=document.getElementById("deleteConfirmModal");existingModal&&existingModal.remove(),document.body.insertAdjacentHTML("beforeend",modalHtml);var modal=document.getElementById("deleteConfirmModal");$(modal).modal("show"),document.getElementById("confirmDeleteBtn").addEventListener("click",(function(){self.deleteDocument(docId,courseid,cmid,templateid,el),$(modal).modal("hide")})),$(modal).on("hidden.bs.modal",(function(){modal.remove()}))},deleteDocument:function(docId,courseid,cmid,templateid,el){var self=this;console.log("üóëÔ∏è Usuwanie dokumentu ID:",docId);var row=document.querySelector('tr[data-docid="'+docId+'"]');row&&(row.style.opacity="0.5",row.innerHTML='<td colspan="6" class="text-center"><i class="fa fa-spinner fa-spin"></i> Usuwanie dokumentu...</td>'),Ajax.call([{methodname:"mod_valuemapdoc_delete_entry",args:{entryid:parseInt(docId)}}])[0].then((function(response){console.log("‚úÖ Dokument usuniƒôty pomy≈õlnie:",response),Notification.addNotification({message:"Dokument zosta≈Ç pomy≈õlnie usuniƒôty.",type:"success"}),self.loadTableContent(courseid,cmid,templateid,el)})).catch((function(error){console.error("‚ùå B≈ÇƒÖd podczas usuwania dokumentu:",error),Notification.addNotification({message:"WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania dokumentu. Spr√≥buj ponownie.",type:"error"}),self.loadTableContent(courseid,cmid,templateid,el)}))},initRefreshButton:function(){var self=this,refreshBtn=document.querySelector("#refresh-documents-btn");refreshBtn?(refreshBtn.addEventListener("click",(function(event){event.preventDefault(),self.refreshDocumentsList()})),console.log("‚úÖ Zainicjalizowano przycisk od≈õwie≈ºania")):console.warn("‚ö†Ô∏è Nie znaleziono przycisku od≈õwie≈ºania (#refresh-documents-btn)")},refreshDocumentsList:function(){console.log("üîÑ Od≈õwie≈ºanie listy dokument√≥w...");var refreshBtn=document.querySelector("#refresh-documents-btn"),refreshIcon=refreshBtn?refreshBtn.querySelector("i"):null,refreshText=refreshBtn?refreshBtn.querySelector(".btn-text"):null;refreshBtn&&(refreshBtn.disabled=!0,refreshIcon&&(refreshIcon.className="fa fa-spinner fa-spin"),refreshText&&(refreshText.textContent="Od≈õwie≈ºanie...")),this.tableElement&&(this.tableElement.innerHTML='<div class="text-center py-4"><i class="fa fa-spinner fa-spin fa-2x text-primary mb-2"></i><p class="text-muted">≈Åadowanie dokument√≥w...</p></div>'),this.loadTableContent(this.courseid,this.cmid,this.templateid,this.tableElement,(function(){refreshBtn&&(refreshBtn.disabled=!1,refreshIcon&&(refreshIcon.className="fa fa-refresh"),refreshText&&(refreshText.textContent="Od≈õwie≈º")),console.log("‚úÖ Lista dokument√≥w od≈õwie≈ºona pomy≈õlnie")}))}}}));

//# sourceMappingURL=tablecontent.min.js.map