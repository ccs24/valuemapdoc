define("mod_valuemapdoc/tablecontent",["core/ajax","core/str","core/notification","jquery"],(function(Ajax,Str,Notification,$){return{init:function(params){console.log("üì¶ ZA≈ÅADOWANO plik tablecontent.js"),setTimeout((()=>{console.log("üöÄ init funkcja zosta≈Ça uruchomiona");const el=document.querySelector("#valuemapdoc-content-table");if(!el)return void console.error("‚ùå Nie znaleziono elementu DOM: #valuemapdoc-content-table");const courseid=el.dataset.courseid,cmid=(null==params?void 0:params.cmid)||el.dataset.cmid,templateid=(null==params?void 0:params.templateid)||el.dataset.templateid;this.courseid=courseid,this.cmid=cmid,this.templateid=templateid,this.tableElement=el,this.initRefreshButton(),this.loadTableContent(courseid,cmid,templateid,el)}),0)},loadTableContent:function(courseid,cmid,templateid,el,callback){Ajax.call([{methodname:"mod_valuemapdoc_get_content_entries",args:{courseid:courseid,cmid:cmid,include_master:templateid}}])[0].then(function(response){var _document$querySelect;console.log("üì• Otrzymane dane z AJAX:",response);response.map((entry=>({...entry,opportunityname:entry.name})));let html="";0===response.length?html='\n                        <div class="alert alert-info text-center">\n                            <i class="fa fa-info-circle fa-2x mb-2" aria-hidden="true"></i>\n                            <h5>Brak dokument√≥w</h5>\n                            <p>Nie ma jeszcze utworzonych dokument√≥w. Wygeneruj pierwszy dokument, aby rozpoczƒÖƒá.</p>\n                        </div>\n                    ':(html='\n                        <div class="table-responsive">\n                            <table class="table table-striped table-hover">\n                                <thead class="thead-light">\n                                    <tr>\n                                        <th scope="col">Nazwa dokumentu</th>\n                                        <th scope="col">Szablon</th>\n                                        <th scope="col">Utworzony</th>\n                                        <th scope="col">Status</th>\n                                        <th scope="col">Ocena</th>\n                                        <th scope="col" class="text-center">Akcje</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                    ',response.forEach((entry=>{console.log("üîç Przetwarzanie wpisu:",entry);const templateName=entry.templatename||"Brak szablonu",createdDate=entry.timecreated;let statusBadge="";statusBadge="pending"===entry.status?'<span class="badge badge-warning"><i class="fa fa-clock-o"></i> Generowanie</span>':"error"===entry.status?'<span class="badge badge-danger"><i class="fa fa-exclamation-triangle"></i> B≈ÇƒÖd</span>':1==entry.visibility?'<span class="badge badge-warning"><i class="fa fa-lock"></i> Prywatny</span>':'<span class="badge badge-success"><i class="fa fa-globe"></i> Wsp√≥≈Çdzielony</span>';let ratingDisplay='<span class="text-muted">Nie oceniony</span>';null!==entry.effectiveness&&void 0!==entry.effectiveness&&(1==entry.effectiveness?ratingDisplay='<span class="text-success"><i class="fa fa-thumbs-up"></i> Dobry</span>':0==entry.effectiveness?ratingDisplay='<span class="text-warning"><i class="fa fa-meh-o"></i> Neutralny</span>':-1==entry.effectiveness&&(ratingDisplay='<span class="text-danger"><i class="fa fa-thumbs-down"></i> Z≈Çy</span>'));let actionButtons="";actionButtons="pending"===entry.status?'\n                                <div class="btn-group btn-group-sm" role="group">\n                                    <button class="btn btn-outline-secondary btn-sm" disabled>\n                                        <i class="fa fa-clock-o"></i>\n                                    </button>\n                                    <a href="'.concat(M.cfg.wwwroot,"/mod/valuemapdoc/rate_content.php?id=").concat(cmid,"&docid=").concat(entry.id,'" \n                                       class="btn btn-outline-primary btn-sm" \n                                       title="PodglƒÖd i ocena">\n                                        <i class="fa fa-eye"></i>\n                                    </a>\n                                    <button class="btn btn-outline-danger btn-sm delete-document" \n                                            data-docid="').concat(entry.id,'" \n                                            data-docname="').concat(entry.name,'"\n                                            title="Usu≈Ñ dokument">\n                                        <i class="fa fa-trash"></i>\n                                    </button>\n                                </div>\n                            '):"error"===entry.status?'\n                                <div class="btn-group btn-group-sm" role="group">\n                                    <button class="btn btn-outline-danger btn-sm" disabled>\n                                        <i class="fa fa-exclamation-triangle"></i>\n                                    </button>\n                                    <a href="'.concat(M.cfg.wwwroot,"/mod/valuemapdoc/rate_content.php?id=").concat(cmid,"&docid=").concat(entry.id,'" \n                                       class="btn btn-outline-primary btn-sm" \n                                       title="PodglƒÖd i ocena">\n                                        <i class="fa fa-eye"></i>\n                                    </a>\n                                    <button class="btn btn-outline-danger btn-sm delete-document" \n                                            data-docid="').concat(entry.id,'" \n                                            data-docname="').concat(entry.name,'"\n                                            title="Usu≈Ñ dokument">\n                                        <i class="fa fa-trash"></i>\n                                    </button>\n                                </div>\n                            '):'\n                                <div class="btn-group btn-group-sm" role="group">\n                                    <a href="'.concat(M.cfg.wwwroot,"/mod/valuemapdoc/rate_content.php?id=").concat(cmid,"&docid=").concat(entry.id,'" \n                                       class="btn btn-outline-primary btn-sm" \n                                       title="PodglƒÖd i ocena">\n                                        <i class="fa fa-eye"></i>\n                                    </a>\n                                    <a href="').concat(M.cfg.wwwroot,"/mod/valuemapdoc/edit_content.php?id=").concat(cmid,"&docid=").concat(entry.id,'" \n                                       class="btn btn-outline-secondary btn-sm" \n                                       title="Edytuj">\n                                        <i class="fa fa-edit"></i>\n                                    </a>\n                                    <a href="').concat(M.cfg.wwwroot,"/mod/valuemapdoc/tune_content.php?id=").concat(cmid,"&docid=").concat(entry.id,'" \n                                       class="btn btn-outline-info btn-sm" \n                                       title="Dostraj">\n                                        <i class="fa fa-cog"></i>\n                                    </a>\n                                    <button class="btn btn-outline-danger btn-sm delete-document" \n                                            data-docid="').concat(entry.id,'" \n                                            data-docname="').concat(entry.name,'"\n                                            title="Usu≈Ñ dokument">\n                                        <i class="fa fa-trash"></i>\n                                    </button>\n                                </div>\n                            '),html+='\n                            <tr class="document-row" data-docid="'.concat(entry.id,'">\n                                <td>\n                                    <div class="d-flex align-items-center">\n                                        <i class="fa fa-file-text-o text-primary mr-2" aria-hidden="true"></i>\n                                        <div>\n                                            <strong>').concat(entry.name,"</strong>\n                                            ").concat(entry.content?'<br><small class="text-muted">'.concat(entry.content,"</small>"):"",'\n                                        </div>\n                                    </div>\n                                </td>\n                                <td>\n                                    <span class="badge badge-secondary">').concat(templateName,"</span>\n                                </td>\n                                <td>\n                                    <small>").concat(createdDate,"</small>\n                                    ").concat(entry.timemodified&&entry.timemodified!==entry.timecreated?'<br><small class="text-muted">Zmieniony: '.concat(new Date(1e3*entry.timemodified).toLocaleDateString("pl-PL"),"</small>"):"","\n                                </td>\n                                <td>\n                                    ").concat(statusBadge,"\n                                </td>\n                                <td>\n                                    ").concat(ratingDisplay,'\n                                </td>\n                                <td class="text-center">\n                                    ').concat(actionButtons,"\n                                </td>\n                            </tr>\n                        ")})),html+="\n                                </tbody>\n                            </table>\n                        </div>\n                    "),null===(_document$querySelect=document.querySelector(".initial-documents"))||void 0===_document$querySelect||_document$querySelect.remove(),el.classList.remove("d-none"),el.innerHTML=html,this.addTableInteractions(courseid,cmid,templateid,el),"function"==typeof callback&&callback()}.bind(this)).catch((function(error){console.error("‚ùå AJAX error:",error),el.innerHTML='\n                    <div class="alert alert-danger">\n                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n                        WystƒÖpi≈Ç b≈ÇƒÖd podczas ≈Çadowania dokument√≥w. \n                        <button class="btn btn-sm btn-outline-danger ml-2" onclick="location.reload()">\n                            <i class="fa fa-refresh"></i> Od≈õwie≈º\n                        </button>\n                    </div>\n                ',"function"==typeof callback&&callback()}))},addTableInteractions:function(courseid,cmid,templateid,el){document.querySelectorAll(".document-row").forEach((row=>{row.addEventListener("mouseenter",(function(){this.classList.add("table-active")})),row.addEventListener("mouseleave",(function(){this.classList.remove("table-active")})),row.addEventListener("dblclick",(function(){const viewLink=this.querySelector('a[title*="PodglƒÖd"]');viewLink&&window.open(viewLink.href,"_blank")}))}));document.querySelectorAll(".delete-document").forEach((button=>{button.addEventListener("click",(event=>{event.preventDefault(),event.stopPropagation();const docId=button.dataset.docid,docName=button.dataset.docname;this.showDeleteConfirmation(docId,docName,courseid,cmid,templateid,el)}))})),console.log("‚úÖ Dodano interakcje do tabeli")},showDeleteConfirmation:function(docId,docName,courseid,cmid,templateid,el){const modalHtml='\n                <div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">\n                    <div class="modal-dialog" role="document">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h5 class="modal-title" id="deleteConfirmModalLabel">\n                                    <i class="fa fa-exclamation-triangle text-warning"></i> \n                                    Potwierdzenie usuniƒôcia\n                                </h5>\n                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="modal-body">\n                                <p>Czy na pewno chcesz usunƒÖƒá dokument:</p>\n                                <p><strong>"'.concat(docName,'"</strong></p>\n                                <div class="alert alert-warning">\n                                    <i class="fa fa-warning"></i>\n                                    <strong>Uwaga:</strong> Ta operacja jest nieodwracalna!\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-dismiss="modal">\n                                    <i class="fa fa-times"></i> Anuluj\n                                </button>\n                                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">\n                                    <i class="fa fa-trash"></i> Usu≈Ñ dokument\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            '),existingModal=document.getElementById("deleteConfirmModal");existingModal&&existingModal.remove(),document.body.insertAdjacentHTML("beforeend",modalHtml);const modal=document.getElementById("deleteConfirmModal");$(modal).modal("show");document.getElementById("confirmDeleteBtn").addEventListener("click",(()=>{this.deleteDocument(docId,courseid,cmid,templateid,el),$(modal).modal("hide")})),$(modal).on("hidden.bs.modal",(function(){modal.remove()}))},deleteDocument:function(docId,courseid,cmid,templateid,el){console.log("üóëÔ∏è Usuwanie dokumentu ID:",docId);const row=document.querySelector('tr[data-docid="'.concat(docId,'"]'));row&&(row.style.opacity="0.5",row.innerHTML='\n                    <td colspan="6" class="text-center">\n                        <i class="fa fa-spinner fa-spin"></i> Usuwanie dokumentu...\n                    </td>\n                '),Ajax.call([{methodname:"mod_valuemapdoc_delete_entry",args:{entryid:parseInt(docId)}}])[0].then((response=>{console.log("‚úÖ Dokument usuniƒôty pomy≈õlnie:",response),Notification.addNotification({message:"Dokument zosta≈Ç pomy≈õlnie usuniƒôty.",type:"success"}),this.loadTableContent(courseid,cmid,templateid,el)})).catch((error=>{console.error("‚ùå B≈ÇƒÖd podczas usuwania dokumentu:",error),Notification.addNotification({message:"WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania dokumentu. Spr√≥buj ponownie.",type:"error"}),this.loadTableContent(courseid,cmid,templateid,el)}))},initRefreshButton:function(){const refreshBtn=document.querySelector("#refresh-documents-btn");refreshBtn?(refreshBtn.addEventListener("click",(event=>{event.preventDefault(),this.refreshDocumentsList()})),console.log("‚úÖ Zainicjalizowano przycisk od≈õwie≈ºania")):console.warn("‚ö†Ô∏è Nie znaleziono przycisku od≈õwie≈ºania (#refresh-documents-btn)")},refreshDocumentsList:function(){console.log("üîÑ Od≈õwie≈ºanie listy dokument√≥w...");const refreshBtn=document.querySelector("#refresh-documents-btn"),refreshIcon=null==refreshBtn?void 0:refreshBtn.querySelector("i"),refreshText=null==refreshBtn?void 0:refreshBtn.querySelector(".btn-text");refreshBtn&&(refreshBtn.disabled=!0,refreshIcon&&(refreshIcon.className="fa fa-spinner fa-spin"),refreshText&&(refreshText.textContent="Od≈õwie≈ºanie...")),this.tableElement&&(this.tableElement.innerHTML='\n                    <div class="text-center py-4">\n                        <i class="fa fa-spinner fa-spin fa-2x text-primary mb-2"></i>\n                        <p class="text-muted">≈Åadowanie dokument√≥w...</p>\n                    </div>\n                '),this.loadTableContent(this.courseid,this.cmid,this.templateid,this.tableElement,(()=>{refreshBtn&&(refreshBtn.disabled=!1,refreshIcon&&(refreshIcon.className="fa fa-refresh"),refreshText&&(refreshText.textContent="Od≈õwie≈º")),console.log("‚úÖ Lista dokument√≥w od≈õwie≈ºona pomy≈õlnie")}))}}}));

//# sourceMappingURL=tablecontent.min.js.map